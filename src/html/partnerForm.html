<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevo Socio</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <!-- Header -->
        <div class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl mb-6">
            <h2 class="text-xl font-bold text-gray-900 flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-900" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span>Nuevo Socio</span>
            </h2>
        </div>

        <!-- Indicador de pasos -->
        <div class="bg-white rounded-xl shadow-sm p-4 mb-4 border border-gray-200">
            <div class="flex items-center justify-center space-x-4">
                <div class="flex items-center space-x-2">
                    <div id="step1Indicator" class="w-8 h-8 rounded-full bg-black text-white flex items-center justify-center font-bold">1</div>
                    <span id="step1Text" class="font-medium text-black">Datos del Socio</span>
                </div>
                <div class="w-16 h-1 bg-gray-300" id="stepConnector"></div>
                <div class="flex items-center space-x-2">
                    <div id="step2Indicator" class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">2</div>
                    <span id="step2Text" class="font-medium text-gray-400">Membresía</span>
                </div>
            </div>
        </div>

        <!-- Formulario Paso 1: Datos del Socio -->
        <div id="step1Content" class="bg-white rounded-xl shadow-md p-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Foto del socio -->
                <div class="flex flex-col items-center">
                    <div class="w-48 h-48 bg-gray-200 rounded-lg relative flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-gray-400 transition cursor-pointer overflow-hidden" id="photoContainer">
                        <div id="photoPlaceholder" class="text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <p class="text-sm text-gray-500 font-medium">Foto del socio</p>
                            <p class="text-xs text-gray-400">Click para seleccionar</p>
                        </div>
                        <img id="photoPreview" class="hidden w-full h-full object-cover" alt="Preview" />
                    </div>
                    <input type="file" id="photoInput" accept="image/*" class="hidden" />
                </div>

                <!-- Formulario de datos -->
                <div class="lg:col-span-2">
                    <form id="partnerForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Nombre <span class="text-red-500">*</span>
                                </label>
                                <input name="firstName" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Apellido <span class="text-red-500">*</span>
                                </label>
                                <input name="lastName" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    DNI/ID <span class="text-red-500">*</span>
                                </label>
                                <input name="dni" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Fecha de nacimiento
                                </label>
                                <input type="date" name="birthdate"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sexo</label>
                                <select name="gender"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                    <option value="">-- Seleccionar --</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                    <option value="O">Otro</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cód. País</label>
                                    <input name="countryCode" value="1"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                                    <input name="phone"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Domicilio</label>
                            <input name="address"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Profesión</label>
                            <input name="profession"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" name="email"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" />
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">¿Cómo nos conoció?</label>
                                <textarea name="howKnow" rows="3"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Observaciones</label>
                                <textarea name="observations" rows="3"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"></textarea>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                            <button type="button" id="cancelBtn"
                                class="px-5 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                Cancelar
                            </button>
                            <button type="submit" id="partnerFormNextBtn"
                                class="px-5 py-2 text-sm font-medium text-white bg-black rounded-lg hover:bg-gray-800 transition flex items-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                                </svg>
                                <span>SIGUIENTE</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Formulario Paso 2: Membresía -->
        <div id="step2Content" class="bg-white rounded-xl shadow-md p-6 hidden">
            <div class="space-y-6">
                <!-- Resumen del socio -->
                <div class="bg-gray-100 border border-gray-300 rounded-lg p-4">
                    <h3 class="font-bold text-gray-900 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        Socio Seleccionado
                    </h3>
                    <p id="partnerSummary" class="text-gray-700">-</p>
                </div>

                <!-- Formulario de membresía -->
                <form id="membershipForm" class="space-y-4">
                    <!-- Selección de Actividad -->
                    <div class="bg-white border border-gray-300 rounded-lg p-3">
                        <label class="block text-xs font-semibold text-gray-700 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            Actividad <span class="text-red-500">*</span>
                        </label>
                        <select name="activityId" id="activitySelect" required
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-gray-900 focus:border-transparent transition bg-white">
                            <option value="">-- Seleccionar Actividad --</option>
                        </select>
                        
                        <!-- Info de la actividad seleccionada -->
                        <div id="activityInfo" class="mt-2 hidden pt-2 border-t border-gray-200">
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div>
                                    <p class="text-gray-600">Frecuencia:</p>
                                    <p id="activityFrequency" class="font-medium text-gray-900">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Días por semana:</p>
                                    <p id="activityDays" class="font-medium text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Selección de Instructor -->
                    <div class="bg-white border border-gray-300 rounded-lg p-3">
                        <label class="block text-xs font-semibold text-gray-700 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            Instructor a cargo
                        </label>
                        <select name="instructorId" id="instructorSelect"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-gray-900 focus:border-transparent transition bg-white">
                            <option value="">Ninguno</option>
                        </select>
                    </div>

                    <!-- Fecha de vencimiento -->
                    <div class="bg-white border border-gray-300 rounded-lg p-3">
                        <label class="block text-xs font-semibold text-gray-700 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Fecha de vencimiento <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="expirationDate" id="expirationDate" required
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-gray-900 focus:border-transparent transition">
                    </div>

                    <!-- Método de pago -->
                    <div class="bg-white border border-gray-300 rounded-lg p-3">
                        <label class="block text-xs font-semibold text-gray-700 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                            </svg>
                            Método de pago <span class="text-red-500">*</span>
                        </label>
                        <select name="paymentMethod" id="paymentMethod" required
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-gray-900 focus:border-transparent transition bg-white">
                            <option value="">-- Seleccionar método --</option>
                            <option value="efectivo">Efectivo</option>
                            <option value="tarjeta">Tarjeta</option>
                            <option value="transferencia">Transferencia</option>
                        </select>
                    </div>

                    <!-- Precio (desde actividad) -->
                    <div class="bg-black rounded-lg p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs opacity-75 mb-0.5">TOTAL A COBRAR</p>
                                <p class="text-3xl font-bold" id="totalPrice">0</p>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 opacity-30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="flex justify-between pt-3 border-t border-gray-200">
                        <button type="button" id="backBtn"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition flex items-center space-x-1.5">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                            </svg>
                            <span>Atrás</span>
                        </button>
                        <button type="submit" id="chargeBtn"
                            class="px-6 py-2 text-sm font-semibold text-white bg-black rounded-md hover:bg-gray-800 transition shadow-sm flex items-center space-x-1.5">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <span>Cobrar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
      // Si estamos dentro de una ventana de Electron, usar ipcRenderer para enviar los datos al main
      try {
        const { ipcRenderer } = require('electron');
        const axios = require('axios');
        const API_URL = 'http://localhost:4001';

        const form = document.getElementById('partnerForm');
        const membershipForm = document.getElementById('membershipForm');
        const nextBtn = document.getElementById('partnerFormNextBtn');
        const backBtn = document.getElementById('backBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        
        // Elementos de foto
        const photoContainer = document.getElementById('photoContainer');
        const photoInput = document.getElementById('photoInput');
        const photoPreview = document.getElementById('photoPreview');
        const photoPlaceholder = document.getElementById('photoPlaceholder');

        // Elementos de pasos
        const step1Content = document.getElementById('step1Content');
        const step2Content = document.getElementById('step2Content');
        const step1Indicator = document.getElementById('step1Indicator');
        const step2Indicator = document.getElementById('step2Indicator');
        const step1Text = document.getElementById('step1Text');
        const step2Text = document.getElementById('step2Text');
        const stepConnector = document.getElementById('stepConnector');

        // Elementos de Paso 2
        const activitySelect = document.getElementById('activitySelect');
        const instructorSelect = document.getElementById('instructorSelect');
        const activityInfo = document.getElementById('activityInfo');
        const activityFrequency = document.getElementById('activityFrequency');
        const activityDays = document.getElementById('activityDays');
        const totalPrice = document.getElementById('totalPrice');
        const partnerSummary = document.getElementById('partnerSummary');

        let currentPartnerData = null;
        let activities = [];
        let instructors = [];
        let selectedPhotoFile = null;

        // Manejo de foto
        if (photoContainer && photoInput) {
          photoContainer.addEventListener('click', () => {
            photoInput.click();
          });

          photoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
              selectedPhotoFile = file;
              const reader = new FileReader();
              reader.onload = (e) => {
                photoPreview.src = e.target.result;
                photoPreview.classList.remove('hidden');
                photoPlaceholder.classList.add('hidden');
              };
              reader.readAsDataURL(file);
            }
          });
        }

        // Navegar a Paso 2
        if (nextBtn && form) {
          nextBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            
            // Validar formulario
            if (!form.checkValidity()) {
              form.reportValidity();
              return;
            }

            const fd = new FormData(form);
            const data = {};
            fd.forEach((v, k) => data[k] = v);
            currentPartnerData = data;

            // Actualizar resumen del socio
            partnerSummary.textContent = `${data.firstName} ${data.lastName} - DNI: ${data.dni}`;

            // Cargar actividades e instructores
            await loadActivitiesAndInstructors();

            // Mostrar Paso 2
            showStep2();
          });
        }

        // Volver a Paso 1
        if (backBtn) {
          backBtn.addEventListener('click', () => {
            showStep1();
          });
        }

        // Cancelar
        if (cancelBtn) {
          cancelBtn.addEventListener('click', () => {
            ipcRenderer.send('close-partner-form');
          });
        }

        // Cambio de actividad
        if (activitySelect) {
          activitySelect.addEventListener('change', (e) => {
            const activityId = e.target.value;
            if (activityId) {
              const activity = activities.find(a => a.id == activityId);
              if (activity) {
                activityInfo.classList.remove('hidden');
                activityFrequency.textContent = activity.frequency || '-';
                activityDays.textContent = activity.daysPerWeek ? `${activity.daysPerWeek} días` : '-';
                totalPrice.textContent = parseFloat(activity.price).toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
              }
            } else {
              activityInfo.classList.add('hidden');
              totalPrice.textContent = '0';
            }
          });
        }

        // Submit de membresía
        if (membershipForm) {
          membershipForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
              // Obtener el precio de la actividad seleccionada
              const activity = activities.find(a => a.id == parseInt(activitySelect.value));
              const amount = activity ? activity.price : 0;

              // Obtener el método de pago seleccionado
              const paymentMethod = document.getElementById('paymentMethod').value;

              // Preparar datos completos para enviar TODO de golpe
              const completeData = {
                partner: currentPartnerData,
                payment: {
                  amount: amount,
                  paymentDate: new Date().toISOString().split('T')[0], // Fecha de hoy
                  paymentMethod: paymentMethod,
                  description: `Pago de membresía - ${activity.name}`
                },
                activityId: parseInt(activitySelect.value),
                instructorId: instructorSelect.value ? parseInt(instructorSelect.value) : null,
                expirationDate: document.getElementById('expirationDate').value
              };

              // Primero crear el socio con la foto
              const formData = new FormData(form);
              
              // Añadir foto si fue seleccionada
              if (selectedPhotoFile) {
                formData.append('photo', selectedPhotoFile);
              }

              const partnerResponse = await axios.post(`${API_URL}/partners`, formData, {
                headers: { 'Content-Type': 'multipart/form-data' }
              });

              const partnerId = partnerResponse.data.id;

              // Ahora crear el pago
              const paymentResponse = await axios.post(`${API_URL}/payments`, completeData.payment);
              const paymentId = paymentResponse.data.id;

              // Finalmente crear la membresía
              const membershipData = {
                partnerId: partnerId,
                activityId: completeData.activityId,
                instructorId: completeData.instructorId,
                paymentId: paymentId,
                expirationDate: completeData.expirationDate,
                status: 'active'
              };

              await axios.post(`${API_URL}/membership`, membershipData);

              alert('✅ Socio, membresía y pago registrados exitosamente');
              ipcRenderer.send('partner-saved');
              ipcRenderer.send('close-partner-form');

            } catch (error) {
              console.error('Error:', error);
              alert('❌ Error al guardar: ' + (error.response?.data?.message || error.message));
            }
          });
        }

        // Cargar actividades e instructores
        async function loadActivitiesAndInstructors() {
          try {
            const [activitiesRes, instructorsRes] = await Promise.all([
              axios.get(`${API_URL}/activities`),
              axios.get(`${API_URL}/instructors`)
            ]);

            activities = activitiesRes.data;
            instructors = instructorsRes.data;

            // Llenar select de actividades
            activitySelect.innerHTML = '<option value="">-- Seleccionar Actividad --</option>';
            activities.forEach(activity => {
              const option = document.createElement('option');
              option.value = activity.id;
              option.textContent = `${activity.name} - ${activity.frequency} - $${parseFloat(activity.price).toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
              activitySelect.appendChild(option);
            });

            // Llenar select de instructores
            instructorSelect.innerHTML = '<option value="">Ninguno</option>';
            instructors.forEach(instructor => {
              const option = document.createElement('option');
              option.value = instructor.id;
              option.textContent = `${instructor.firstName} ${instructor.lastName}`;
              instructorSelect.appendChild(option);
            });

          } catch (error) {
            console.error('Error al cargar datos:', error);
            alert('Error al cargar actividades e instructores');
          }
        }

        // Mostrar Paso 1
        function showStep1() {
          step1Content.classList.remove('hidden');
          step2Content.classList.add('hidden');
          
          step1Indicator.classList.remove('bg-gray-300', 'text-gray-600');
          step1Indicator.classList.add('bg-black', 'text-white');
          step1Text.classList.remove('text-gray-400');
          step1Text.classList.add('text-black');
          
          step2Indicator.classList.remove('bg-black', 'text-white');
          step2Indicator.classList.add('bg-gray-300', 'text-gray-600');
          step2Text.classList.remove('text-black');
          step2Text.classList.add('text-gray-400');
          
          stepConnector.classList.remove('bg-black');
          stepConnector.classList.add('bg-gray-300');
        }

        // Mostrar Paso 2
        function showStep2() {
          step1Content.classList.add('hidden');
          step2Content.classList.remove('hidden');
          
          step1Indicator.classList.remove('bg-black', 'text-white');
          step1Indicator.classList.add('bg-gray-300', 'text-gray-600');
          step1Text.classList.remove('text-black');
          step1Text.classList.add('text-gray-400');
          
          step2Indicator.classList.remove('bg-gray-300', 'text-gray-600');
          step2Indicator.classList.add('bg-black', 'text-white');
          step2Text.classList.remove('text-gray-400');
          step2Text.classList.add('text-black');
          
          stepConnector.classList.remove('bg-gray-300');
          stepConnector.classList.add('bg-black');
        }

        // Permitir cargar datos si el main los envía
        ipcRenderer.on('load-partner-data', (event, partnerData) => {
          try {
            Object.keys(partnerData || {}).forEach(k => {
              const el = document.querySelector(`[name="${k}"]`);
              if (el) el.value = partnerData[k];
            });
          } catch (err) { console.error(err); }
        });

      } catch (err) {
        console.warn('No se encontró electron ipcRenderer en partnerForm (no-electron).');
      }
    </script>
</body>
</html>